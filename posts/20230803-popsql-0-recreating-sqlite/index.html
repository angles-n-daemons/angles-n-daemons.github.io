<!doctype html><html lang=en><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer"><meta name=description content><link href="https://fonts.googleapis.com/css?family=Open+Sans:400|Old+Standard+TT:400&display=swap" rel=stylesheet media=print type=text/css onload='this.media="all"'><title>popSQL part 0: a DB education through reverse-engineering</title><link rel=canonical href=https://abudlightlime.com/posts/20230803-popsql-0-recreating-sqlite/><style>*{border:0;font:inherit;font-size:100%;vertical-align:baseline;margin:0;padding:0;color:#000;text-decoration-skip:ink}body{font-family:open sans,myriad pro,Myriad,sans-serif;font-size:17px;line-height:160%;color:#1d1313;max-width:700px;margin:auto}p{margin:20px 0}a img{border:none}img{margin:10px auto;max-width:100%;display:block}.left-justify{float:left}.right-justify{float:right}pre,code{font:12px Consolas,liberation mono,Menlo,Courier,monospace;background-color:#f7f7f7}code{font-size:12px;padding:4px}pre{margin-top:0;margin-bottom:16px;word-wrap:normal;padding:16px;overflow:auto;font-size:85%;line-height:1.45}pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:0 0;border:0}pre code{display:inline;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}pre code::before,pre code::after{content:normal}em,q,em,dfn{font-style:italic}.sans,html .gist .gist-file .gist-meta{font-family:open sans,myriad pro,Myriad,sans-serif}.mono,pre,code,tt,p code,li code{font-family:Menlo,Monaco,andale mono,lucida console,courier new,monospace}.heading,.serif,h1,h2,h3{font-family:old standard tt,serif}strong{font-weight:600}q:before{content:"\201C"}q:after{content:"\201D"}del,s{text-decoration:line-through}blockquote{font-family:old standard tt,serif;text-align:center;padding:50px}blockquote p{display:inline-block;font-style:italic}blockquote:before,blockquote:after{font-family:old standard tt,serif;content:'\201C';font-size:35px;color:#403c3b}blockquote:after{content:'\201D'}hr{width:40%;height:1px;background:#403c3b;margin:25px auto}h1{font-size:35px}h2{font-size:28px}h3{font-size:22px;margin-top:18px}h1 a,h2 a,h3 a{text-decoration:none}h1,h2{margin-top:28px}#sub-header,.date{color:#403c3b;font-size:13px}#sub-header{margin:0 4px}#nav h1 a{font-size:35px;color:#1d1313;line-height:120%}.posts_listing a,#nav a{text-decoration:none}li{margin-left:20px}ul li{margin-left:5px}ul li{list-style-type:none}ul li:before{content:"\00BB \0020"}#nav ul li:before,.posts_listing li:before{content:'';margin-right:0}#content{text-align:left;width:100%;font-size:15px;padding:60px 0 80px}#content h1,#content h2{margin-bottom:5px}#content h2{font-size:25px}#content .entry-content{margin-top:15px}#content .date{margin-left:3px}#content h1{font-size:30px}.highlight{margin:10px 0}.posts_listing{margin:0 0 50px}.posts_listing li{margin:0 0 25px 15px}.posts_listing li a:hover,#nav a:hover{text-decoration:underline}#nav{text-align:center;position:static;margin-top:60px}#nav ul{display:table;margin:8px auto 0}#nav li{list-style-type:none;display:table-cell;font-size:15px;padding:0 20px}#links{display:flex;justify-content:space-between;margin:50px 0 0}#links :nth-child(1){margin-right:.5em}#links :nth-child(2){margin-left:.5em}#not-found{text-align:center}#not-found a{font-family:old standard tt,serif;font-size:200px;text-decoration:none;display:inline-block;padding-top:225px}@media(max-width:750px){body{padding-left:20px;padding-right:20px}#nav h1 a{font-size:28px}#nav li{font-size:13px;padding:0 15px}#content{margin-top:0;padding-top:50px;font-size:14px}#content h1{font-size:25px}#content h2{font-size:22px}.posts_listing li div{font-size:12px}}@media(max-width:400px){body{padding-left:20px;padding-right:20px}#nav h1 a{font-size:22px}#nav li{font-size:12px;padding:0 10px}#content{margin-top:0;padding-top:20px;font-size:12px}#content h1{font-size:20px}#content h2{font-size:18px}.posts_listing li div{font-size:12px}}@media(prefers-color-scheme:dark){*,#nav h1 a{color:#fdfdfd}body{background:#121212}pre,code{background-color:#262626}#sub-header,.date{color:#bababa}hr{background:#ebebeb}}</style></head><body><section id=nav><h1><a href=/>The Bud Light Lime Blog</a></h1><ul><li><a href=https://github.com/angles-n-daemons>Github</a></li><li><a href=https://www.linkedin.com/in/brian-dillmann-0a997979/>LinkedIn</a></li><li><a href=https://docs.google.com/document/d/1jkPJ6dlcMnNd-sNn2veAx8Qzf7CQFBuAtXS1_ZSWjig/edit>Resume</a></li></ul></section><section id=content><h1>popSQL part 0: a DB education through reverse-engineering</h1><div id=sub-header>August 2023 Â· 4 minute read</div><div class=entry-content><h1 id=a-liking-for-database-systems>A liking for database systems</h1><p>Databases have long been a special interest of mine. Since taking CS 445 Information Systems at UMass, I&rsquo;ve held a unique curiosity for how databases were used and how they worked under the hood. I found topics like relational algebra fascinating, and I always enjoyed how clean SQL felt. I distinctly remember how enjoyable it was leafing through Michael Stonebraker&rsquo;s <a href=https://redbook.io>Red Book</a> and over time I developed a decent understanding about how to design, interact with and debug production databases.</p><p>For a long while this interest was merely a surface level curiosity, but at a certain point I wanted to dive below that surface - to really understand how SQL statments turned into data, and how the data systems I was using operated so efficiently. The resources on creating databases from scratch were slim (and still seem to be). Books, courses and academia make it easy to interact with existing databases, but not to design one on your own.</p><p>They all seem to miss the sweet spot of being approachable, practical, and true enough to the principles of production systems that one could better understand what&rsquo;s happening under the hood. I treat <a href=https://craftinginterpreters.com/contents.html>Crafting Interpreters</a> my personal gold standard for what I look for in technical literature of this nature, and in databases there wasn&rsquo;t anything equivalent. Luckily, I happened upon the <a href=https://www.sqlite.org/arch.html>SQLite documentation</a> - which in some ways had these properties.</p><p>I decided to try to replicate the behavior of SQLite using the documentation, but quickly ran headfirst into a roadblock. While the documentation was thorough, it was laid out in a way that very detailed questions about how the system works could be answered quickly, and not in a way that someone could easily learn top to bottom what is actually happening. For the benefit of the end users, and the detriment of a curious subscriber like myself the SQLite source is a bit too complex to easily follow. It&rsquo;s tens of thousands of lines of code which has been tuned for optimization rather than readability. Take for example parsing variable length integers (varints), something described in the documentation with one paragraph. The <a href=https://github.com/sqlite/sqlite/blob/master/src/util.c#L1183>source code</a> is nearly 300 lines of C code, with loops unrolled, bitmasks applied, variables stripped down so they represent nothing other than the address space which they occupy. If you compare this to the <a href=https://github.com/angles-n-daemons/popsql/blob/master/pypopsql/util.py#L17>15 lines of python code</a> it takes to do this in a slower, but more digestable format - you come to the reasonable conclusion that SQLite was designed to be a production system and not an educational resource.</p><p>Being discouraged, I abandoned this journey in favor of simpler, lower hanging endeavours. Three years later however, my interest was once again piqued, and SQLite despite my above caveats still remained one of the closest things to an educational resource that I could look for.</p><p>With all this in mind, I&rsquo;m trying once again to replicate a good bit of SQLite functionality in python by taking it slower, and really digging into the source code bit by bit. My goals in this endeavor are to create a good-enough sqlite replication which covers some of the core functionality employed by SQLite.</p><p>It should be noted that as this is an educational exercise, performance is an afterthought. You&rsquo;ll note this as my code runs lots of transformations to and from byte arrays, which SQLite ignores in the name of speed. I still haven&rsquo;t come to a conclusion as to how much of the source implementation I intend to replicate, whether I&rsquo;ll replicate the lemon parser generator, if I plan to replicate the bytecode engine. I figure I&rsquo;ll take it week by week and try to get the testable bits working and see where things go from there.</p><p>Feel free to read the following blog posts to see how this journey goes, and take a look at the <a href=https://github.com/angles-n-daemons/pypopsql>source repository</a> to see what the result of this adventure looks like.</p></div><div id=links><a href=https://abudlightlime.com/posts/20230217-rbac-and-rebac/>&#171;&nbsp;RBAC x ReBAC, a hybrid authorization model for big technology companies</a>
<a href=https://abudlightlime.com/posts/20230805-popsql-1-reading-db-pages/>popSQL part 1: reading the sqlite database file&nbsp;&#187;</a></div></section></body></html>