<!doctype html><html lang=en><head>
<title>Home</title>
<meta charset=utf-8>
<meta content="utf-8" http-equiv=encoding>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=format-detection content="telephone=no">
<meta name=theme-color content="#000084">
<link rel=icon href=https://abudlightlime.com/favicon.ico>
<link rel=canonical href=https://abudlightlime.com>
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
<div class=navbar-inner>
<div class=container>
<button type=button class="btn btn-navbar" data-toggle=collapse data-target=.nav-collapse></button>
<a class=brand href=https://abudlightlime.com>Home</a>
<div class="nav-collapse collapse">
<ul class=nav>
<li>
<a href=/about/>
<span>About</span>
</a>
</li>
<li>
<a href=/post/>
<span>All posts</span>
</a>
</li>
</ul>
</div>
</div>
</div>
</nav><div id=content class=container>
<div class="row-fluid navmargin">
<div class=page-header>
<h1>Diagnosing MySQL deadlocks - Fri, Nov 26, 2021</h1>
</div>
<p class=lead></p>
<h1 id=an-unpleasant-exception>An unpleasant exception</h1>
<pre tabindex=0><code>Deadlock found when trying to get lock; try restarting transaction
</code></pre><p>If you&rsquo;re reading this document, you&rsquo;re either here out of curiosity or necessity. I&rsquo;ll be brief for those in the latter camp. When you encounter the above error in production, you only need the stack trace to figure out which query got blocked. What I have found is difficult to ascertain is which query is doing the actual blocking.</p>
<p>A precursory search for mysql deadlock errors will show that entering the command <code>show engine innodb status</code> &ldquo;gives you information about the last known deadlock&rdquo;. What you probably haven&rsquo;t been told is that unless you&rsquo;ve scanned the output of this command before you are in for a bit of heavy reading.</p>
<p>To find the offending transaction blocking the above, search the output for the section containing the phrase <code>HOLDS THE LOCK(S):</code>, and the offending query should be right above it. Example output below:</p>
<pre tabindex=0><code>MySQL thread id 2, OS thread handle 140555289204480, query id 22 172.17.0.1 root updating           
DELETE FROM t WHERE i = 1                                                                           
*** (2) HOLDS THE LOCK(S): 
</code></pre>
<h4><a href=https://abudlightlime.com>Back to Home</a></h4>
</div>
</div><footer class=container>
<hr class=soften>
<p>
<a href=https://gitlab.com/maxlefou/hugo.386>hugo.386 theme</a> |
&copy;
Brian Dillmann
<span id=thisyear>2020</span>
| brooklyn&rsquo;s noodle king
| Built on <a href=//gohugo.io target=_blank>Hugo</a>
</p>
<p class=text-center>
<a href=https://www.linkedin.com/in/brian-dillmann-0a997979/>Linkedin</a>
<a href=https://github.com/angles-n-daemons>GitHub</a>
</p>
</footer>
</body><link rel=stylesheet href=/css/bootstrap.css>
<link rel=stylesheet href=/css/bootstrap-responsive.css>
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=/customstyle.css>
<script src=/js/jquery.js></script>
<script src=/js/bootstrap-386.js></script>
<script src=/js/bootstrap-transition.js></script>
<script src=/js/bootstrap-alert.js></script>
<script src=/js/bootstrap-modal.js></script>
<script src=/js/bootstrap-dropdown.js></script>
<script src=/js/bootstrap-scrollspy.js></script>
<script src=/js/bootstrap-tab.js></script>
<script src=/js/bootstrap-tooltip.js></script>
<script src=/js/bootstrap-popover.js></script>
<script src=/js/bootstrap-button.js></script>
<script src=/js/bootstrap-collapse.js></script>
<script src=/js/bootstrap-carousel.js></script>
<script src=/js/bootstrap-typeahead.js></script>
<script src=/js/bootstrap-affix.js></script>
<script>_386={fastLoad:!1,onePass:!1,speedFactor:1};function ThisYear(){document.getElementById('thisyear').innerHTML=(new Date).getFullYear()}</script></html>